{
  "openapi": "3.1.0",
  "info": {
    "title": "Arash External API Service",
    "description": "\n# Arash External API Service\n\nA production-ready, multi-tenant AI chatbot service supporting both public (Telegram) and private (custom channel) integrations with enterprise-grade features.\n\n## \ud83d\ude80 Key Features\n\n### Multi-Platform Support\n- **Telegram Integration**: Public bot accessible to all Telegram users\n- **Custom Channel Integrations**: Private, isolated channels for enterprise clients\n- **Multi-Model AI**: Support for GPT, Claude, Gemini, DeepSeek, and more\n\n### Enterprise Features\n- **Two-Tier Authentication**: Super admin keys and channel-level API keys\n- **Channel Isolation**: Complete data separation between channels\n- **Usage Tracking**: Comprehensive analytics and quota management\n- **Rate Limiting**: Per-user, per-channel rate controls\n- **Session Management**: Persistent conversation history with automatic cleanup\n\n### Security & Compliance\n- **API Key Authentication**: SHA256-hashed keys with prefix visibility\n- **Access Control**: Role-based access (super admin vs. channel level)\n- **Quota Enforcement**: Monthly and daily usage limits\n- **Audit Logging**: Complete request/response tracking\n\n## \ud83d\udcda API Overview\n\n### Public Endpoints (Channel Access)\n- `POST /v1/chat`: Process chat messages\n- `GET /v1/commands`: Get available commands\n- `GET /health`: Service health check (no auth required)\n\n### Admin Endpoints (Super Admin Only)\n- `GET /v1/admin/`: Admin dashboard with platform statistics\n- `POST /v1/admin/channels`: Create new channel with auto-generated API key\n- `GET /v1/admin/channels`: List all channels with usage stats\n- `PATCH /v1/admin/channels/{id}`: Update channel configuration\n\n## \ud83d\udd10 Authentication\n\n### Channel API Keys\n- **Format**: `ark_` prefix + 40 character hash\n- **Usage**: Include in `Authorization: Bearer <key>` header\n- **Scope**: Access to `/v1/chat` and `/v1/commands` endpoints only\n\n### Super Admin Keys\n- **Configuration**: Set via `SUPER_ADMIN_API_KEYS` environment variable\n- **Usage**: Include in `Authorization: Bearer <key>` header\n- **Scope**: Full access to all `/v1/admin/*` endpoints\n\n### Telegram Service Key\n- **Configuration**: Set via `TELEGRAM_SERVICE_KEY` environment variable\n- **Usage**: Used by Telegram bot to access chat endpoints\n- **Scope**: Access to `/v1/chat` endpoint with Telegram platform routing\n\n## \ud83c\udfd7\ufe0f Architecture\n\n- **Session Management**: In-memory sessions with PostgreSQL persistence\n- **Channel Routing**: Automatic platform detection from API keys\n- **AI Service Integration**: Multi-model routing with fallback support\n- **Database**: PostgreSQL with SQLAlchemy ORM and Alembic migrations\n- **Containerization**: Docker-ready with Kubernetes manifests\n\n## \ud83d\udcca Usage Tracking\n\nAll API requests are logged with:\n- Request count and success rate\n- Token usage and estimated costs\n- Response time metrics\n- Model usage breakdown\n- Per-channel analytics\n\n## \ud83d\udd17 External Resources\n\n- [Full API Documentation](https://github.com/irisaprime/external-api-finisher)\n- [Architecture Guide](https://github.com/irisaprime/external-api-finisher/blob/main/ARCHITECTURE_HIERARCHY.md)\n    ",
    "contact": {
      "name": "Arash API Support",
      "email": "support@arash-api.example.com"
    },
    "license": {
      "name": "Proprietary",
      "identifier": "Proprietary"
    },
    "version": "1.0.0"
  },
  "paths": {
    "/v1/chat": {
      "post": {
        "tags": [
          "Chat & Commands"
        ],
        "summary": "Process chat message with AI",
        "description": "Process a user's chat message through the AI service and return a response. Supports conversation history, commands, and multi-model routing. Each user maintains one continuous conversation per channel with automatic session management.",
        "operationId": "process_chat_message",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/IncomingMessage"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful chat response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BotResponse"
                },
                "examples": {
                  "first_message": {
                    "summary": "First message in conversation",
                    "value": {
                      "success": true,
                      "response": "\u0633\u0644\u0627\u0645! \u0686\u0637\u0648\u0631 \u0645\u06cc\u200c\u062a\u0648\u0646\u0645 \u06a9\u0645\u06a9\u062a\u0648\u0646 \u06a9\u0646\u0645\u061f",
                      "model": "Gemini 2.0 Flash",
                      "total_message_count": 2
                    }
                  },
                  "continuing_conversation": {
                    "summary": "Continuing an existing conversation",
                    "value": {
                      "success": true,
                      "response": "\u0627\u0644\u0628\u062a\u0647! \u0641\u0631\u0622\u06cc\u0646\u062f \u062e\u0631\u06cc\u062f \u062e\u06cc\u0644\u06cc \u0633\u0627\u062f\u0647 \u0627\u0633\u062a. \u0627\u0628\u062a\u062f\u0627 \u0645\u062d\u0635\u0648\u0644 \u0645\u0648\u0631\u062f \u0646\u0638\u0631 \u0631\u0627 \u0627\u0646\u062a\u062e\u0627\u0628 \u06a9\u0646\u06cc\u062f...",
                      "model": "DeepSeek Chat V3",
                      "total_message_count": 12
                    }
                  },
                  "after_clear": {
                    "summary": "After using /clear command",
                    "value": {
                      "success": true,
                      "response": "\u062a\u0627\u0631\u06cc\u062e\u0686\u0647 \u06af\u0641\u062a\u06af\u0648 \u067e\u0627\u06a9 \u0634\u062f. \u0686\u0637\u0648\u0631 \u0645\u06cc\u200c\u062a\u0648\u0646\u0645 \u06a9\u0645\u06a9\u062a\u0648\u0646 \u06a9\u0646\u0645\u061f",
                      "model": "GPT-4o Mini",
                      "total_message_count": 26
                    }
                  },
                  "rate_limit_exceeded": {
                    "summary": "Rate limit exceeded",
                    "value": {
                      "success": false,
                      "error": "rate_limit_exceeded",
                      "response": "\u26a0\ufe0f \u0645\u062d\u062f\u0648\u062f\u06cc\u062a \u0633\u0631\u0639\u062a. \u0644\u0637\u0641\u0627\u064b \u0642\u0628\u0644 \u0627\u0632 \u0627\u0631\u0633\u0627\u0644 \u067e\u06cc\u0627\u0645 \u0628\u0639\u062f\u06cc \u06a9\u0645\u06cc \u0635\u0628\u0631 \u06a9\u0646\u06cc\u062f.\n\n\u0645\u062d\u062f\u0648\u062f\u06cc\u062a: 60 \u067e\u06cc\u0627\u0645 \u062f\u0631 \u062f\u0642\u06cc\u0642\u0647"
                    }
                  },
                  "ai_service_error": {
                    "summary": "AI service unavailable",
                    "value": {
                      "success": false,
                      "error": "ai_service_unavailable",
                      "response": "\u0645\u062a\u0623\u0633\u0641\u0645\u060c \u0633\u0631\u0648\u06cc\u0633 \u0647\u0648\u0634 \u0645\u0635\u0646\u0648\u0639\u06cc \u062f\u0631 \u062d\u0627\u0644 \u062d\u0627\u0636\u0631 \u062f\u0631 \u062f\u0633\u062a\u0631\u0633 \u0646\u06cc\u0633\u062a. \u0644\u0637\u0641\u0627\u064b \u0686\u0646\u062f \u0644\u062d\u0638\u0647 \u062f\u06cc\u06af\u0631 \u062f\u0648\u0628\u0627\u0631\u0647 \u062a\u0644\u0627\u0634 \u06a9\u0646\u06cc\u062f \u06cc\u0627 \u0628\u0627 \u067e\u0634\u062a\u06cc\u0628\u0627\u0646\u06cc \u062a\u0645\u0627\u0633 \u0628\u06af\u06cc\u0631\u06cc\u062f."
                    }
                  },
                  "access_denied": {
                    "summary": "API key trying to access another key's user",
                    "value": {
                      "success": false,
                      "error": "access_denied",
                      "response": "\u274c \u062f\u0633\u062a\u0631\u0633\u06cc \u0631\u062f \u0634\u062f. \u0627\u06cc\u0646 \u0645\u06a9\u0627\u0644\u0645\u0647 \u0645\u062a\u0639\u0644\u0642 \u0628\u0647 API key \u062f\u06cc\u06af\u0631\u06cc \u0627\u0633\u062a."
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid input data",
            "content": {
              "application/json": {
                "examples": {
                  "empty_text": {
                    "summary": "Empty message text",
                    "value": {
                      "detail": "Message text cannot be empty"
                    }
                  },
                  "empty_user_id": {
                    "summary": "Empty user ID",
                    "value": {
                      "detail": "User ID cannot be empty"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required - No API key provided",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Authentication required. Please provide an API key in the Authorization header."
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Invalid or inactive API key",
            "content": {
              "application/json": {
                "examples": {
                  "invalid_key": {
                    "summary": "Invalid API key",
                    "value": {
                      "detail": "Invalid API key. Please check your credentials."
                    }
                  },
                  "inactive_key": {
                    "summary": "Inactive API key",
                    "value": {
                      "detail": "API key is inactive or revoked"
                    }
                  },
                  "expired_key": {
                    "summary": "Expired API key",
                    "value": {
                      "detail": "API key has expired"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation error - Request body doesn't match schema",
            "content": {
              "application/json": {
                "example": {
                  "detail": [
                    {
                      "loc": [
                        "body",
                        "user_id"
                      ],
                      "msg": "field required",
                      "type": "value_error.missing"
                    },
                    {
                      "loc": [
                        "body",
                        "text"
                      ],
                      "msg": "field required",
                      "type": "value_error.missing"
                    }
                  ]
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "examples": {
                  "api_key_validation_error": {
                    "summary": "Error validating API key",
                    "value": {
                      "detail": "Error validating API key"
                    }
                  },
                  "database_error": {
                    "summary": "Database connection error",
                    "value": {
                      "detail": "Database error occurred"
                    }
                  },
                  "general_error": {
                    "summary": "Unexpected server error",
                    "value": {
                      "detail": "An unexpected error occurred"
                    }
                  }
                }
              }
            }
          },
          "503": {
            "description": "Service unavailable - AI service or database is down",
            "content": {
              "application/json": {
                "examples": {
                  "ai_service_down": {
                    "summary": "AI service unavailable",
                    "value": {
                      "success": false,
                      "error": "service_unavailable",
                      "response": "\u0633\u0631\u0648\u06cc\u0633 \u0647\u0648\u0634 \u0645\u0635\u0646\u0648\u0639\u06cc \u062f\u0631 \u062d\u0627\u0644 \u062d\u0627\u0636\u0631 \u062f\u0631 \u062f\u0633\u062a\u0631\u0633 \u0646\u06cc\u0633\u062a."
                    }
                  },
                  "database_down": {
                    "summary": "Database unavailable",
                    "value": {
                      "detail": "Database service is currently unavailable"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/v1/commands": {
      "get": {
        "tags": [
          "Chat & Commands"
        ],
        "summary": "Get available bot commands",
        "description": "Retrieve the list of available commands for the authenticated channel with Persian descriptions. Commands vary based on channel type (Telegram vs. private channels). Private channels typically have access to model switching and advanced commands.",
        "operationId": "get_available_commands",
        "responses": {
          "200": {
            "description": "List of available commands",
            "content": {
              "application/json": {
                "schema": {},
                "examples": {
                  "telegram_commands": {
                    "summary": "Telegram (public) commands",
                    "value": {
                      "success": true,
                      "platform": "telegram",
                      "commands": [
                        {
                          "command": "start",
                          "description": "\u0634\u0631\u0648\u0639 \u0631\u0628\u0627\u062a \u0648 \u062f\u0631\u06cc\u0627\u0641\u062a \u067e\u06cc\u0627\u0645 \u062e\u0648\u0634\u200c\u0622\u0645\u062f\u06af\u0648\u06cc\u06cc",
                          "usage": "/start"
                        },
                        {
                          "command": "help",
                          "description": "\u0646\u0645\u0627\u06cc\u0634 \u0631\u0627\u0647\u0646\u0645\u0627\u06cc \u0627\u0633\u062a\u0641\u0627\u062f\u0647 \u0648 \u062f\u0633\u062a\u0648\u0631\u0627\u062a \u0645\u0648\u062c\u0648\u062f",
                          "usage": "/help"
                        },
                        {
                          "command": "clear",
                          "description": "\u067e\u0627\u06a9 \u06a9\u0631\u062f\u0646 \u062a\u0627\u0631\u06cc\u062e\u0686\u0647 \u06af\u0641\u062a\u06af\u0648 \u0648 \u0634\u0631\u0648\u0639 \u0645\u062c\u062f\u062f",
                          "usage": "/clear"
                        }
                      ]
                    }
                  },
                  "internal_commands": {
                    "summary": "Internal (private) commands",
                    "value": {
                      "success": true,
                      "platform": "Internal-BI",
                      "commands": [
                        {
                          "command": "start",
                          "description": "\u0634\u0631\u0648\u0639 \u0631\u0628\u0627\u062a \u0648 \u062f\u0631\u06cc\u0627\u0641\u062a \u067e\u06cc\u0627\u0645 \u062e\u0648\u0634\u200c\u0622\u0645\u062f\u06af\u0648\u06cc\u06cc",
                          "usage": "/start"
                        },
                        {
                          "command": "help",
                          "description": "\u0646\u0645\u0627\u06cc\u0634 \u0631\u0627\u0647\u0646\u0645\u0627\u06cc \u0627\u0633\u062a\u0641\u0627\u062f\u0647 \u0648 \u062f\u0633\u062a\u0648\u0631\u0627\u062a \u0645\u0648\u062c\u0648\u062f",
                          "usage": "/help"
                        },
                        {
                          "command": "model",
                          "description": "\u062a\u063a\u06cc\u06cc\u0631 \u0645\u062f\u0644 \u0647\u0648\u0634 \u0645\u0635\u0646\u0648\u0639\u06cc",
                          "usage": "/model"
                        },
                        {
                          "command": "models",
                          "description": "\u0646\u0645\u0627\u06cc\u0634 \u0644\u06cc\u0633\u062a \u062a\u0645\u0627\u0645 \u0645\u062f\u0644\u200c\u0647\u0627\u06cc \u0645\u0648\u062c\u0648\u062f",
                          "usage": "/models"
                        },
                        {
                          "command": "clear",
                          "description": "\u067e\u0627\u06a9 \u06a9\u0631\u062f\u0646 \u062a\u0627\u0631\u06cc\u062e\u0686\u0647 \u06af\u0641\u062a\u06af\u0648 \u0648 \u0634\u0631\u0648\u0639 \u0645\u062c\u062f\u062f",
                          "usage": "/clear"
                        },
                        {
                          "command": "status",
                          "description": "\u0646\u0645\u0627\u06cc\u0634 \u0648\u0636\u0639\u06cc\u062a \u0646\u0634\u0633\u062a \u0648 \u0627\u0637\u0644\u0627\u0639\u0627\u062a \u062c\u0627\u0631\u06cc",
                          "usage": "/status"
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required - No API key provided",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Authentication required. Please provide an API key in the Authorization header."
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Invalid or inactive API key",
            "content": {
              "application/json": {
                "examples": {
                  "invalid_key": {
                    "summary": "Invalid API key",
                    "value": {
                      "detail": "Invalid API key. Please check your credentials."
                    }
                  },
                  "inactive_key": {
                    "summary": "Inactive API key",
                    "value": {
                      "detail": "API key is inactive or revoked"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "examples": {
                  "api_key_validation_error": {
                    "summary": "Error validating API key",
                    "value": {
                      "detail": "Error validating API key"
                    }
                  },
                  "platform_error": {
                    "summary": "Error retrieving platform configuration",
                    "value": {
                      "detail": "Failed to retrieve platform configuration"
                    }
                  },
                  "general_error": {
                    "summary": "Unexpected server error",
                    "value": {
                      "detail": "An unexpected error occurred"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/v1/admin/": {
      "get": {
        "tags": [
          "Channel Management & Administration"
        ],
        "summary": "Get admin dashboard with platform overview and statistics",
        "description": "Retrieve comprehensive admin dashboard data including service health, platform configurations, and real-time session statistics across all channels. Shows Telegram and internal platform settings, active sessions, model usage breakdown, and per-channel analytics. Super admin access required.",
        "operationId": "get_admin_dashboard",
        "responses": {
          "200": {
            "description": "Admin dashboard data retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AdminDashboardResponse"
                },
                "example": {
                  "service": "Arash External API Service",
                  "version": "1.0.0",
                  "status": "healthy",
                  "timestamp": "2025-01-15T14:30:00",
                  "platforms": {
                    "telegram": {
                      "type": "public",
                      "model": "Gemini 2.0 Flash",
                      "rate_limit": 20,
                      "commands": [
                        "start",
                        "help",
                        "clear"
                      ]
                    },
                    "internal": {
                      "type": "private",
                      "default_model": "Gemini 2.0 Flash",
                      "available_models": [
                        "Gemini 2.0 Flash",
                        "GPT-5 Chat"
                      ],
                      "rate_limit": 60
                    }
                  },
                  "statistics": {
                    "total_sessions": 150,
                    "active_sessions": 25
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required - No super admin API key provided",
            "content": {
              "application/json": {
                "examples": {
                  "no_auth_header": {
                    "summary": "Missing Authorization header",
                    "value": {
                      "detail": "Authentication required"
                    }
                  },
                  "admin_keys_not_configured": {
                    "summary": "Super admin keys not configured",
                    "value": {
                      "detail": "Super admin authentication not configured"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Invalid super admin API key",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Invalid super admin API key"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "examples": {
                  "database_error": {
                    "summary": "Database connection error",
                    "value": {
                      "detail": "Failed to retrieve dashboard data"
                    }
                  },
                  "general_error": {
                    "summary": "Unexpected server error",
                    "value": {
                      "detail": "An unexpected error occurred"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/v1/admin/channels": {
      "post": {
        "tags": [
          "Channel Management & Administration"
        ],
        "summary": "Create new channel with auto-generated API key",
        "description": "Create a new channel for external integrations with an automatically generated API key. The full API key is returned ONLY ONCE in this response - save it securely. Channels can be configured with custom quotas, rate limits, AI models, and access controls. Super admin access required.",
        "operationId": "create_channel",
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChannelCreate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Channel created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChannelCreateResponse"
                },
                "example": {
                  "id": 1,
                  "title": "\u062a\u06cc\u0645 \u0647\u0648\u0634 \u0645\u0635\u0646\u0648\u0639\u06cc \u062f\u0627\u062e\u0644\u06cc",
                  "channel_id": "Internal-BI",
                  "monthly_quota": 100000,
                  "daily_quota": 5000,
                  "is_active": true,
                  "created_at": "2025-01-15T10:00:00",
                  "api_key": "ark_1234567890abcdef1234567890abcdef12345678",
                  "warning": "Save this API key securely. It will not be shown again."
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid input or channel_id already exists",
            "content": {
              "application/json": {
                "examples": {
                  "channel_exists": {
                    "summary": "Channel ID already exists",
                    "value": {
                      "detail": "Channel with ID 'Internal-BI' already exists"
                    }
                  },
                  "invalid_channel_id": {
                    "summary": "Invalid channel_id format",
                    "value": {
                      "detail": "channel_id must be ASCII characters without spaces"
                    }
                  },
                  "invalid_quota": {
                    "summary": "Invalid quota value",
                    "value": {
                      "detail": "Quota values must be positive integers"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required - No super admin API key provided",
            "content": {
              "application/json": {
                "examples": {
                  "no_auth_header": {
                    "summary": "Missing Authorization header",
                    "value": {
                      "detail": "Authentication required"
                    }
                  },
                  "admin_keys_not_configured": {
                    "summary": "Super admin keys not configured",
                    "value": {
                      "detail": "Super admin authentication not configured"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Invalid super admin API key",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Invalid super admin API key"
                }
              }
            }
          },
          "422": {
            "description": "Validation error - Request body doesn't match schema",
            "content": {
              "application/json": {
                "example": {
                  "detail": [
                    {
                      "loc": [
                        "body",
                        "channel_id"
                      ],
                      "msg": "field required",
                      "type": "value_error.missing"
                    }
                  ]
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "examples": {
                  "database_error": {
                    "summary": "Database error during channel creation",
                    "value": {
                      "detail": "Failed to create channel due to database error"
                    }
                  },
                  "api_key_generation_error": {
                    "summary": "Error generating API key",
                    "value": {
                      "detail": "Channel created but API key generation failed"
                    }
                  },
                  "general_error": {
                    "summary": "Unexpected server error",
                    "value": {
                      "detail": "An unexpected error occurred"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": [
          "Channel Management & Administration"
        ],
        "summary": "List all channels with usage statistics",
        "description": "Retrieve a list of all channels with their configuration and usage statistics. Optionally filter by active status, specify the time period for usage data, or include an aggregated total report across all channels. Super admin access required.",
        "operationId": "list_channels",
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "parameters": [
          {
            "name": "channel_id",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "integer"
                },
                {
                  "type": "null"
                }
              ],
              "title": "Channel Id"
            }
          },
          {
            "name": "active_only",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "default": true,
              "title": "Active Only"
            }
          },
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 30,
              "title": "Days"
            }
          },
          {
            "name": "totally",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "default": false,
              "title": "Totally"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Channels list retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChannelsListResponse"
                },
                "examples": {
                  "channels_list": {
                    "summary": "List of channels with usage statistics",
                    "value": {
                      "channels": [
                        {
                          "id": 1,
                          "title": "Internal BI Team",
                          "channel_id": "Internal-BI",
                          "monthly_quota": 100000,
                          "daily_quota": 5000,
                          "is_active": true,
                          "api_key_prefix": "ark_1234",
                          "created_at": "2025-01-01T10:00:00",
                          "updated_at": "2025-01-15T14:30:00",
                          "usage": {
                            "requests": {
                              "total": 15000,
                              "successful": 14850
                            }
                          }
                        }
                      ]
                    }
                  },
                  "channels_with_total": {
                    "summary": "Channels list with total aggregated report",
                    "value": {
                      "channels": [
                        {
                          "id": 1,
                          "title": "Internal BI Team",
                          "channel_id": "Internal-BI",
                          "monthly_quota": 100000,
                          "is_active": true
                        }
                      ],
                      "total_report": {
                        "total_channels": 5,
                        "active_channels": 4,
                        "total_requests": 75000,
                        "total_cost": 75.5
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required - No super admin API key provided",
            "content": {
              "application/json": {
                "examples": {
                  "no_auth_header": {
                    "summary": "Missing Authorization header",
                    "value": {
                      "detail": "Authentication required"
                    }
                  },
                  "admin_keys_not_configured": {
                    "summary": "Super admin keys not configured",
                    "value": {
                      "detail": "Super admin authentication not configured"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Invalid super admin API key",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Invalid super admin API key"
                }
              }
            }
          },
          "404": {
            "description": "Not found - Channel with specified ID does not exist",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Channel not found"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "examples": {
                  "database_error": {
                    "summary": "Database connection error",
                    "value": {
                      "detail": "Failed to retrieve channels from database"
                    }
                  },
                  "usage_stats_error": {
                    "summary": "Error calculating usage statistics",
                    "value": {
                      "detail": "Failed to calculate usage statistics"
                    }
                  },
                  "general_error": {
                    "summary": "Unexpected server error",
                    "value": {
                      "detail": "An unexpected error occurred"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/v1/admin/channels/{channel_id}": {
      "patch": {
        "tags": [
          "Channel Management & Administration"
        ],
        "summary": "Update channel configuration",
        "description": "Update one or more settings for an existing channel. All fields are optional - only provide the fields you want to update. Returns the updated channel with usage statistics for the specified period. WARNING: Changing channel_id will break existing sessions and integrations. Super admin access required.",
        "operationId": "update_channel",
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "parameters": [
          {
            "name": "channel_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "title": "Channel Id"
            }
          },
          {
            "name": "days",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 30,
              "title": "Days"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChannelUpdate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Channel updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ChannelResponse"
                },
                "example": {
                  "id": 1,
                  "title": "Internal BI Channel Updated",
                  "channel_id": "Internal-BI-v2",
                  "monthly_quota": 150000,
                  "daily_quota": 7000,
                  "is_active": true,
                  "api_key_prefix": "ark_1234",
                  "api_key_last_used": "2025-01-15T14:30:00",
                  "created_at": "2025-01-01T10:00:00",
                  "updated_at": "2025-01-16T10:00:00",
                  "usage": {
                    "requests": {
                      "total": 15000,
                      "successful": 14850
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request - Invalid update data",
            "content": {
              "application/json": {
                "examples": {
                  "channel_exists": {
                    "summary": "Channel ID already exists (when changing channel_id)",
                    "value": {
                      "detail": "Channel ID 'Internal-BI-v2' is already in use by another channel"
                    }
                  },
                  "invalid_quota": {
                    "summary": "Invalid quota value",
                    "value": {
                      "detail": "Quota values must be positive integers or null"
                    }
                  },
                  "no_fields_provided": {
                    "summary": "No fields to update",
                    "value": {
                      "detail": "At least one field must be provided for update"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication required - No super admin API key provided",
            "content": {
              "application/json": {
                "examples": {
                  "no_auth_header": {
                    "summary": "Missing Authorization header",
                    "value": {
                      "detail": "Authentication required"
                    }
                  },
                  "admin_keys_not_configured": {
                    "summary": "Super admin keys not configured",
                    "value": {
                      "detail": "Super admin authentication not configured"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Forbidden - Invalid super admin API key",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Invalid super admin API key"
                }
              }
            }
          },
          "404": {
            "description": "Not found - Channel with specified ID does not exist",
            "content": {
              "application/json": {
                "example": {
                  "detail": "Channel not found"
                }
              }
            }
          },
          "422": {
            "description": "Validation error - Request body doesn't match schema",
            "content": {
              "application/json": {
                "example": {
                  "detail": [
                    {
                      "loc": [
                        "body",
                        "monthly_quota"
                      ],
                      "msg": "value is not a valid integer",
                      "type": "type_error.integer"
                    }
                  ]
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "examples": {
                  "database_error": {
                    "summary": "Database error during update",
                    "value": {
                      "detail": "Failed to update channel due to database error"
                    }
                  },
                  "usage_stats_error": {
                    "summary": "Error retrieving usage statistics",
                    "value": {
                      "detail": "Channel updated but failed to retrieve usage statistics"
                    }
                  },
                  "general_error": {
                    "summary": "Unexpected server error",
                    "value": {
                      "detail": "An unexpected error occurred"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": [
          "Health & Monitoring"
        ],
        "summary": "Service health check",
        "description": "Check the health status of the API service and its dependencies. Returns 'healthy' if all services are operational, 'degraded' if the AI service is unavailable. No authentication required - designed for monitoring systems, load balancers, and orchestration platforms.",
        "operationId": "health_check",
        "responses": {
          "200": {
            "description": "Service health status",
            "content": {
              "application/json": {
                "schema": {},
                "examples": {
                  "healthy": {
                    "summary": "Service is healthy",
                    "value": {
                      "status": "healthy",
                      "service": "Arash External API Service",
                      "version": "1.0.0",
                      "timestamp": "2025-01-15T14:30:00"
                    }
                  },
                  "degraded": {
                    "summary": "Service is degraded (AI service unavailable)",
                    "value": {
                      "status": "degraded",
                      "service": "Arash External API Service",
                      "version": "1.0.0",
                      "timestamp": "2025-01-15T14:30:00"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "example": {
                  "success": false,
                  "error": "internal_server_error",
                  "detail": "An internal error occurred"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "AdminDashboardResponse": {
        "properties": {
          "service": {
            "type": "string",
            "title": "Service",
            "description": "Service name identifier",
            "examples": [
              "Arash External API Service"
            ]
          },
          "version": {
            "type": "string",
            "title": "Version",
            "description": "Semantic version of the API service",
            "examples": [
              "1.0.0",
              "1.2.3"
            ]
          },
          "status": {
            "type": "string",
            "title": "Status",
            "description": "Overall service health status. 'healthy': All systems operational (AI service responsive). 'degraded': Service running but AI service unavailable. 'down': Critical failure (database unavailable, etc.).",
            "examples": [
              "healthy",
              "degraded",
              "down"
            ]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "title": "Timestamp",
            "description": "ISO 8601 timestamp when this dashboard data was generated (UTC)",
            "examples": [
              "2025-01-30T14:30:00Z"
            ]
          },
          "platforms": {
            "additionalProperties": {
              "additionalProperties": true,
              "type": "object"
            },
            "type": "object",
            "title": "Platforms",
            "description": "Platform configurations for 'telegram' (public) and 'internal' (private). Each platform contains: type, model(s), rate_limit, commands, max_history, features. Shows current configuration for all platforms managed by the service."
          },
          "statistics": {
            "additionalProperties": true,
            "type": "object",
            "title": "Statistics",
            "description": "Real-time statistics for active sessions and usage. Contains: total_sessions, active_sessions, telegram (breakdown), internal (breakdown). Telegram breakdown: sessions, messages, active, model. Internal breakdown: sessions, messages, active, models_used, channel_breakdown."
          }
        },
        "type": "object",
        "required": [
          "service",
          "version",
          "status",
          "timestamp",
          "platforms",
          "statistics"
        ],
        "title": "AdminDashboardResponse",
        "description": "Unified admin dashboard response with platform info and statistics\n\nCombines health check, platform configurations, and statistics into a single endpoint",
        "examples": [
          {
            "platforms": {
              "internal": {
                "available_models": [
                  "Gemini 2.0 Flash",
                  "GPT-5 Chat",
                  "DeepSeek v3"
                ],
                "commands": [
                  "start",
                  "help",
                  "model",
                  "models",
                  "clear",
                  "status"
                ],
                "default_model": "Gemini 2.0 Flash",
                "features": {
                  "model_switching": true,
                  "requires_auth": true
                },
                "max_history": 30,
                "rate_limit": 60,
                "type": "private"
              },
              "telegram": {
                "commands": [
                  "start",
                  "help",
                  "model",
                  "clear"
                ],
                "features": {
                  "model_switching": false,
                  "requires_auth": true
                },
                "max_history": 10,
                "model": "Gemini 2.0 Flash",
                "rate_limit": 20,
                "type": "public"
              }
            },
            "service": "Arash External API Service",
            "statistics": {
              "active_sessions": 25,
              "internal": {
                "active": 20,
                "channel_breakdown": [
                  {
                    "active": 15,
                    "channel_id": 1,
                    "channel_name": "Internal BI",
                    "messages": 3000,
                    "models_used": {
                      "Gemini 2.0 Flash": 60
                    },
                    "sessions": 100
                  }
                ],
                "messages": 5000,
                "models_used": {
                  "DeepSeek v3": 20,
                  "GPT-5 Chat": 40,
                  "Gemini 2.0 Flash": 80
                },
                "sessions": 140
              },
              "telegram": {
                "active": 5,
                "messages": 500,
                "model": "Gemini 2.0 Flash",
                "sessions": 10
              },
              "total_sessions": 150
            },
            "status": "healthy",
            "timestamp": "2025-01-15T14:30:00",
            "version": "1.0.0"
          }
        ]
      },
      "BotResponse": {
        "properties": {
          "success": {
            "type": "boolean",
            "title": "Success",
            "description": "Indicates whether the request was processed successfully. True for successful AI responses, False for errors (rate limits, service unavailable, etc.)",
            "examples": [
              true,
              false
            ]
          },
          "response": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Response",
            "description": "The response text - either AI-generated content (when success=true) or a user-friendly error message (when success=false). May include Persian/English text depending on the user's message language.",
            "examples": [
              "\u0633\u0644\u0627\u0645! \u0686\u0637\u0648\u0631 \u0645\u06cc\u200c\u062a\u0648\u0646\u0645 \u06a9\u0645\u06a9\u062a\u0648\u0646 \u06a9\u0646\u0645\u061f",
              "Paris is the capital of France.",
              "\u26a0\ufe0f Rate limit exceeded. Please wait."
            ]
          },
          "model": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Model",
            "description": "User-friendly name of the AI model used to generate the response. Examples: 'Gemini 2.0 Flash', 'GPT-5 Chat', 'Claude Sonnet 4', 'DeepSeek Chat V3'. May be null in error responses.",
            "examples": [
              "Gemini 2.0 Flash",
              "GPT-5 Chat",
              "Claude Sonnet 4",
              "DeepSeek Chat V3"
            ]
          },
          "total_message_count": {
            "anyOf": [
              {
                "type": "integer",
                "minimum": 0.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Total Message Count",
            "description": "Total number of chat messages in conversation history (user messages + AI responses). Persists through /clear commands (database count, not AI context). Commands like /clear, /model, /help are NOT counted - only actual chat messages. May be null in error responses.",
            "examples": [
              2,
              8,
              15,
              24,
              50
            ]
          },
          "error": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Error",
            "description": "Machine-readable error code when success=false. Null when success=true. Use this field for programmatic error handling. Common codes: rate_limit_exceeded, ai_service_unavailable, authentication_failed, quota_exceeded, access_denied, invalid_model, processing_error.",
            "examples": [
              "rate_limit_exceeded",
              "ai_service_unavailable",
              "authentication_failed",
              "quota_exceeded",
              "access_denied"
            ]
          }
        },
        "type": "object",
        "required": [
          "success"
        ],
        "title": "BotResponse",
        "description": "Response returned after processing a chat message.\n\n**Response Structure:**\n- `success`: Indicates whether the request was processed successfully\n- `response`: The AI-generated text response or error message (user-facing)\n- `model`: The AI model used to generate the response\n- `total_message_count`: Total chat messages in conversation (excludes commands)\n- `error`: Machine-readable error code when success=false\n\n**Success Response (success=true):**\nContains the AI's response in the `response` field, along with metadata about the\ncurrent model and message count. The `error` field will be null.\n\n**Error Response (success=false):**\nContains a user-friendly error message in the `response` field and a machine-readable\nerror code in the `error` field. The `model` and `total_message_count` may be null.\n\n**Conversation Tracking:**\n- `total_message_count` persists through `/clear` commands (database count)\n- Only actual chat messages and AI responses are counted\n- Commands (`/clear`, `/model`, `/help`, etc.) are NOT counted\n- Count includes both user messages and assistant responses\n\n**Error Codes:**\n- `rate_limit_exceeded`: User has exceeded rate limit for this channel\n- `ai_service_unavailable`: AI service is down or unreachable\n- `authentication_failed`: Invalid or missing API key\n- `quota_exceeded`: Monthly or daily quota has been reached\n- `access_denied`: User attempting to access another user's conversation\n- `invalid_model`: Requested model is not available for this channel\n- `processing_error`: Unexpected error during message processing",
        "examples": [
          {
            "model": "Gemini 2.0 Flash",
            "response": "\u0633\u0644\u0627\u0645! \u0645\u0646 \u062f\u0633\u062a\u06cc\u0627\u0631 \u0647\u0648\u0634 \u0645\u0635\u0646\u0648\u0639\u06cc \u0647\u0633\u062a\u0645. \u0686\u0637\u0648\u0631 \u0645\u06cc\u200c\u062a\u0648\u0646\u0645 \u06a9\u0645\u06a9\u062a\u0648\u0646 \u06a9\u0646\u0645\u061f",
            "success": true,
            "total_message_count": 2
          },
          {
            "model": "GPT-5 Chat",
            "response": "Paris is the capital of France. It's known for the Eiffel Tower, the Louvre Museum, and its rich cultural history.",
            "success": true,
            "total_message_count": 8
          },
          {
            "model": "Claude Sonnet 4",
            "response": "\u2705 \u0645\u062f\u0644 \u0628\u0647 Claude Sonnet 4 \u062a\u063a\u06cc\u06cc\u0631 \u06cc\u0627\u0641\u062a. \u062d\u0627\u0644\u0627 \u0645\u06cc\u200c\u062a\u0648\u0646\u06cc\u062f \u0627\u0632 \u0642\u0627\u0628\u0644\u06cc\u062a\u200c\u0647\u0627\u06cc \u067e\u06cc\u0634\u0631\u0641\u062a\u0647\u200c\u062a\u0631 \u0627\u0633\u062a\u0641\u0627\u062f\u0647 \u06a9\u0646\u06cc\u062f.",
            "success": true,
            "total_message_count": 15
          },
          {
            "model": "DeepSeek Chat V3",
            "response": "\u2728 \u062a\u0627\u0631\u06cc\u062e\u0686\u0647 \u06af\u0641\u062a\u06af\u0648 \u067e\u0627\u06a9 \u0634\u062f! \u0622\u0645\u0627\u062f\u0647 \u0634\u0631\u0648\u0639 \u06af\u0641\u062a\u06af\u0648\u06cc \u062c\u062f\u06cc\u062f \u0647\u0633\u062a\u0645.",
            "success": true,
            "total_message_count": 24
          },
          {
            "error": "rate_limit_exceeded",
            "response": "\u26a0\ufe0f \u0645\u062d\u062f\u0648\u062f\u06cc\u062a \u0633\u0631\u0639\u062a. \u0634\u0645\u0627 \u0628\u06cc\u0634 \u0627\u0632 \u062d\u062f \u0645\u062c\u0627\u0632 \u067e\u06cc\u0627\u0645 \u0627\u0631\u0633\u0627\u0644 \u06a9\u0631\u062f\u0647\u200c\u0627\u06cc\u062f.\n\n\u0645\u062d\u062f\u0648\u062f\u06cc\u062a: 60 \u067e\u06cc\u0627\u0645 \u062f\u0631 \u062f\u0642\u06cc\u0642\u0647\n\u0644\u0637\u0641\u0627\u064b \u0686\u0646\u062f \u062b\u0627\u0646\u06cc\u0647 \u0635\u0628\u0631 \u06a9\u0646\u06cc\u062f \u0648 \u062f\u0648\u0628\u0627\u0631\u0647 \u0627\u0645\u062a\u062d\u0627\u0646 \u06a9\u0646\u06cc\u062f.",
            "success": false
          },
          {
            "error": "ai_service_unavailable",
            "response": "\u0645\u062a\u0623\u0633\u0641\u0645\u060c \u0633\u0631\u0648\u06cc\u0633 \u0647\u0648\u0634 \u0645\u0635\u0646\u0648\u0639\u06cc \u062f\u0631 \u062d\u0627\u0644 \u062d\u0627\u0636\u0631 \u062f\u0631 \u062f\u0633\u062a\u0631\u0633 \u0646\u06cc\u0633\u062a. \u0644\u0637\u0641\u0627\u064b \u0686\u0646\u062f \u0644\u062d\u0638\u0647 \u062f\u06cc\u06af\u0631 \u062f\u0648\u0628\u0627\u0631\u0647 \u062a\u0644\u0627\u0634 \u06a9\u0646\u06cc\u062f \u06cc\u0627 \u0628\u0627 \u067e\u0634\u062a\u06cc\u0628\u0627\u0646\u06cc \u062a\u0645\u0627\u0633 \u0628\u06af\u06cc\u0631\u06cc\u062f.",
            "success": false
          },
          {
            "error": "quota_exceeded",
            "response": "\u26a0\ufe0f \u0633\u0647\u0645\u06cc\u0647 \u0645\u0627\u0647\u0627\u0646\u0647 \u0634\u0645\u0627 \u062a\u0645\u0627\u0645 \u0634\u062f\u0647 \u0627\u0633\u062a. \u0628\u0631\u0627\u06cc \u0627\u0641\u0632\u0627\u06cc\u0634 \u0633\u0647\u0645\u06cc\u0647 \u0628\u0627 \u0645\u062f\u06cc\u0631 \u0633\u06cc\u0633\u062a\u0645 \u062a\u0645\u0627\u0633 \u0628\u06af\u06cc\u0631\u06cc\u062f.",
            "success": false
          },
          {
            "error": "access_denied",
            "response": "\u274c \u062f\u0633\u062a\u0631\u0633\u06cc \u0631\u062f \u0634\u062f. \u0627\u06cc\u0646 \u0645\u06a9\u0627\u0644\u0645\u0647 \u0645\u062a\u0639\u0644\u0642 \u0628\u0647 \u06a9\u0627\u0631\u0628\u0631 \u062f\u06cc\u06af\u0631\u06cc \u0627\u0633\u062a.",
            "success": false
          }
        ]
      },
      "ChannelCreate": {
        "properties": {
          "title": {
            "anyOf": [
              {
                "type": "string",
                "maxLength": 200,
                "minLength": 1
              },
              {
                "type": "null"
              }
            ],
            "title": "Title",
            "description": "Human-friendly display name for the channel (supports Persian/Farsi and multilingual text). Used in admin UI, reports, and logs for easy identification. If not provided, defaults to channel_id value. Examples: '\u062a\u06cc\u0645 \u0647\u0648\u0634 \u0645\u0635\u0646\u0648\u0639\u06cc \u062f\u0627\u062e\u0644\u06cc', 'Internal BI Team', 'Marketing Platform'",
            "examples": [
              "\u062a\u06cc\u0645 \u0647\u0648\u0634 \u0645\u0635\u0646\u0648\u0639\u06cc \u062f\u0627\u062e\u0644\u06cc",
              "Internal BI Team",
              "\u067e\u0644\u062a\u0641\u0631\u0645 \u0628\u0627\u0632\u0627\u0631\u06cc\u0627\u0628\u06cc"
            ]
          },
          "channel_id": {
            "type": "string",
            "maxLength": 100,
            "minLength": 1,
            "pattern": "^[a-zA-Z0-9_-]+$",
            "title": "Channel Id",
            "description": "Unique system identifier for routing and session isolation (ASCII only, no spaces). Used internally for session keys, logging, and API routing. Must be unique across all channels. Recommended format: PascalCase or kebab-case (e.g., 'Internal-BI', 'External-Marketing'). Cannot be changed after creation without breaking existing sessions.",
            "examples": [
              "Internal-BI",
              "External-Marketing",
              "Data-Analytics",
              "Customer-Support"
            ]
          },
          "access_type": {
            "type": "string",
            "pattern": "^(public|private)$",
            "title": "Access Type",
            "description": "Platform access control type determining feature set and visibility. 'public': Open access platforms (e.g., Telegram, Discord) with limited models and basic features. 'private': Restricted access channels (e.g., customer integrations, internal teams) with full features, multiple AI models, and enterprise capabilities. Affects default configurations for rate limits, models, and commands.",
            "default": "private",
            "examples": [
              "private",
              "public"
            ]
          },
          "monthly_quota": {
            "anyOf": [
              {
                "type": "integer",
                "minimum": 0.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Monthly Quota",
            "description": "Maximum number of requests allowed per calendar month for this channel. None or 0 = unlimited (use with caution). When exceeded, all requests return quota_exceeded error. Resets on the 1st of each month. Tracked across all users in this channel.",
            "examples": [
              100000,
              50000,
              null
            ]
          },
          "daily_quota": {
            "anyOf": [
              {
                "type": "integer",
                "minimum": 0.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Daily Quota",
            "description": "Maximum number of requests allowed per day (UTC) for this channel. None or 0 = unlimited (use with caution). When exceeded, all requests return quota_exceeded error. Resets daily at 00:00 UTC. Tracked across all users in this channel.",
            "examples": [
              5000,
              2000,
              null
            ]
          },
          "rate_limit": {
            "anyOf": [
              {
                "type": "integer",
                "maximum": 1000.0,
                "minimum": 1.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Rate Limit",
            "description": "Override default rate limit in requests per minute per user. None = use access_type default (typically 20 for public, 60 for private). Prevents abuse by limiting how many messages a single user can send per minute. Tracked per user_id within this channel. Recommended: 20-60 for most use cases, higher for high-volume automation.",
            "examples": [
              20,
              60,
              80,
              null
            ]
          },
          "max_history": {
            "anyOf": [
              {
                "type": "integer",
                "maximum": 100.0,
                "minimum": 1.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Max History",
            "description": "Override maximum conversation history length (number of messages). None = use access_type default (typically 10 for public, 30 for private). Determines how many recent messages are sent to the AI model for context. Longer history = better context but higher token usage and costs. Messages beyond this limit are excluded from AI context but kept in database.",
            "examples": [
              10,
              30,
              50,
              null
            ]
          },
          "default_model": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Default Model",
            "description": "Override default AI model (technical ID format: 'provider/model-name'). None = use access_type default (typically 'google/gemini-2.0-flash-001' for public). This is the model users will use unless they switch with /model command. Must be in the available_models list. Examples: 'openai/gpt-5-chat', 'anthropic/claude-4.1', 'google/gemini-2.0-flash-001'",
            "examples": [
              "openai/gpt-5-chat",
              "google/gemini-2.0-flash-001",
              "anthropic/claude-4.1",
              null
            ]
          },
          "available_models": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Available Models",
            "description": "Override list of available AI models (technical IDs). None = use access_type default. Users can switch between these models using the /model command (if allow_model_switch=true). Format: ['provider/model-name', ...]. Public channels typically have 1-2 models, private channels may have 5-10+.",
            "examples": [
              [
                "openai/gpt-5-chat",
                "google/gemini-2.0-flash-001"
              ],
              [
                "anthropic/claude-4.1",
                "openai/gpt-5-chat",
                "google/gemini-2.5-flash-001"
              ],
              null
            ]
          },
          "allow_model_switch": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Allow Model Switch",
            "description": "Override whether users can switch AI models using /model command. None = use access_type default (typically False for public, True for private). If True, users can use '/model <alias>' to switch between available_models. If False, /model command is disabled and users are locked to default_model.",
            "examples": [
              true,
              false,
              null
            ]
          }
        },
        "type": "object",
        "required": [
          "channel_id"
        ],
        "title": "ChannelCreate",
        "description": "Request model for creating a channel.\n\nField Distinction:\n- title: Human-friendly name (supports Persian/Farsi) for admin UI and chat\n- channel_id: System identifier for routing (ASCII, no spaces)\n- access_type: 'public' (Telegram, Discord) or 'private' (customer integrations)\n- Platform config overrides: If NULL, uses defaults for access_type\n- Auto-generates API key on creation",
        "examples": [
          {
            "access_type": "private",
            "channel_id": "Internal-BI",
            "daily_quota": 5000,
            "monthly_quota": 100000,
            "title": "\u062a\u06cc\u0645 \u0647\u0648\u0634 \u0645\u0635\u0646\u0648\u0639\u06cc \u062f\u0627\u062e\u0644\u06cc"
          },
          {
            "access_type": "private",
            "channel_id": "External-Marketing",
            "daily_quota": 2000,
            "max_history": 20,
            "monthly_quota": 50000,
            "rate_limit": 40,
            "title": "\u067e\u0644\u062a\u0641\u0631\u0645 \u0628\u0627\u0632\u0627\u0631\u06cc\u0627\u0628\u06cc"
          },
          {
            "access_type": "private",
            "available_models": [
              "openai/gpt-5-chat",
              "google/gemini-2.0-flash-001"
            ],
            "channel_id": "HOSCO-Popak",
            "default_model": "openai/gpt-5-chat",
            "monthly_quota": 75000
          }
        ]
      },
      "ChannelCreateResponse": {
        "properties": {
          "id": {
            "type": "integer",
            "exclusiveMinimum": 0.0,
            "title": "Id",
            "description": "Unique database ID of the newly created channel",
            "examples": [
              1,
              2,
              42
            ]
          },
          "title": {
            "type": "string",
            "title": "Title",
            "description": "Display name of the channel (as created or defaulted to channel_id)",
            "examples": [
              "\u062a\u06cc\u0645 \u0647\u0648\u0634 \u0645\u0635\u0646\u0648\u0639\u06cc \u062f\u0627\u062e\u0644\u06cc",
              "Internal BI Team"
            ]
          },
          "channel_id": {
            "type": "string",
            "title": "Channel Id",
            "description": "System identifier used for routing (as provided during creation)",
            "examples": [
              "Internal-BI",
              "External-Marketing"
            ]
          },
          "access_type": {
            "type": "string",
            "title": "Access Type",
            "description": "Access type: 'public' or 'private'",
            "examples": [
              "private",
              "public"
            ]
          },
          "monthly_quota": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Monthly Quota",
            "description": "Monthly request quota (None = unlimited)",
            "examples": [
              100000,
              null
            ]
          },
          "daily_quota": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Daily Quota",
            "description": "Daily request quota (None = unlimited)",
            "examples": [
              5000,
              null
            ]
          },
          "is_active": {
            "type": "boolean",
            "title": "Is Active",
            "description": "Channel activation status (always True for newly created channels)",
            "examples": [
              true
            ]
          },
          "rate_limit": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Rate Limit",
            "description": "Rate limit override (None = using access_type default)",
            "examples": [
              60,
              null
            ]
          },
          "max_history": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Max History",
            "description": "Max history override (None = using access_type default)",
            "examples": [
              30,
              null
            ]
          },
          "default_model": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Default Model",
            "description": "Default model override (None = using access_type default)",
            "examples": [
              "openai/gpt-5-chat",
              null
            ]
          },
          "available_models": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Available Models",
            "description": "Available models override (None = using access_type default)",
            "examples": [
              [
                "openai/gpt-5-chat"
              ],
              null
            ]
          },
          "allow_model_switch": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Allow Model Switch",
            "description": "Model switching override (None = using access_type default)",
            "examples": [
              true,
              null
            ]
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "title": "Created At",
            "description": "ISO 8601 timestamp of when the channel was created",
            "examples": [
              "2025-01-30T10:00:00Z"
            ]
          },
          "api_key": {
            "type": "string",
            "maxLength": 48,
            "minLength": 48,
            "title": "Api Key",
            "description": "FULL API KEY - Shown ONLY ONCE during creation! Format: 'ark_' prefix + 44 character hash (48 chars total). Save this immediately - it cannot be retrieved later. Use this key in Authorization: Bearer <api_key> header for API requests.",
            "examples": [
              "ark_1234567890abcdef1234567890abcdef12345678",
              "ark_a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0"
            ]
          },
          "warning": {
            "type": "string",
            "title": "Warning",
            "description": "Critical warning about API key storage - this is the only time the full key is visible",
            "default": "Save this API key securely. It will not be shown again."
          }
        },
        "type": "object",
        "required": [
          "id",
          "title",
          "channel_id",
          "access_type",
          "is_active",
          "created_at",
          "api_key"
        ],
        "title": "ChannelCreateResponse",
        "description": "Response model when creating a channel (includes the generated API key).\n\nThe API key is shown ONLY ONCE during creation.",
        "examples": [
          {
            "access_type": "private",
            "api_key": "ark_1234567890abcdef1234567890abcdef12345678",
            "channel_id": "Internal-BI",
            "created_at": "2025-01-15T10:00:00",
            "daily_quota": 5000,
            "id": 1,
            "is_active": true,
            "max_history": 30,
            "monthly_quota": 100000,
            "rate_limit": 60,
            "title": "\u062a\u06cc\u0645 \u0647\u0648\u0634 \u0645\u0635\u0646\u0648\u0639\u06cc \u062f\u0627\u062e\u0644\u06cc",
            "warning": "Save this API key securely. It will not be shown again."
          }
        ]
      },
      "ChannelResponse": {
        "properties": {
          "id": {
            "type": "integer",
            "exclusiveMinimum": 0.0,
            "title": "Id",
            "description": "Unique database identifier for the channel (auto-generated, immutable)",
            "examples": [
              1,
              2,
              42
            ]
          },
          "title": {
            "type": "string",
            "title": "Title",
            "description": "Human-friendly display name (supports Persian/Farsi). Used in admin UI and reports.",
            "examples": [
              "Internal BI Team",
              "\u062a\u06cc\u0645 \u0647\u0648\u0634 \u0645\u0635\u0646\u0648\u0639\u06cc",
              "Marketing Platform"
            ]
          },
          "channel_id": {
            "type": "string",
            "title": "Channel Id",
            "description": "System identifier for routing and session isolation (ASCII, unique, immutable)",
            "examples": [
              "Internal-BI",
              "External-Marketing"
            ]
          },
          "access_type": {
            "type": "string",
            "title": "Access Type",
            "description": "Platform access type: 'public' (limited features) or 'private' (full features)",
            "examples": [
              "private",
              "public"
            ]
          },
          "monthly_quota": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Monthly Quota",
            "description": "Monthly request limit. None = unlimited.",
            "examples": [
              100000,
              null
            ]
          },
          "daily_quota": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Daily Quota",
            "description": "Daily request limit. None = unlimited.",
            "examples": [
              5000,
              null
            ]
          },
          "is_active": {
            "type": "boolean",
            "title": "Is Active",
            "description": "Whether the channel is active. Inactive channels cannot process requests.",
            "examples": [
              true,
              false
            ]
          },
          "rate_limit": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Rate Limit",
            "description": "Rate limit override (requests/min per user). None = using access_type default.",
            "examples": [
              60,
              80,
              null
            ]
          },
          "max_history": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Max History",
            "description": "Max history override (number of messages). None = using access_type default.",
            "examples": [
              30,
              25,
              null
            ]
          },
          "default_model": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Default Model",
            "description": "Default AI model override. None = using access_type default.",
            "examples": [
              "openai/gpt-5-chat",
              null
            ]
          },
          "available_models": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Available Models",
            "description": "Available models override. None = using access_type default.",
            "examples": [
              [
                "openai/gpt-5-chat",
                "google/gemini-2.0-flash-001"
              ],
              null
            ]
          },
          "allow_model_switch": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Allow Model Switch",
            "description": "Model switching permission override. None = using access_type default.",
            "examples": [
              true,
              false,
              null
            ]
          },
          "api_key_prefix": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Api Key Prefix",
            "description": "First 8 characters of the channel's API key (for identification). Full key never shown after creation.",
            "examples": [
              "ark_1234",
              "ark_5678"
            ]
          },
          "api_key_last_used": {
            "anyOf": [
              {
                "type": "string",
                "format": "date-time"
              },
              {
                "type": "null"
              }
            ],
            "title": "Api Key Last Used",
            "description": "ISO 8601 timestamp of when the API key was last used (UTC). None if never used.",
            "examples": [
              "2025-01-30T14:30:00Z",
              null
            ]
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "title": "Created At",
            "description": "ISO 8601 timestamp of when the channel was created (UTC)",
            "examples": [
              "2025-01-15T10:00:00Z"
            ]
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "title": "Updated At",
            "description": "ISO 8601 timestamp of when the channel was last updated (UTC)",
            "examples": [
              "2025-01-30T14:30:00Z"
            ]
          },
          "usage": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Usage",
            "description": "Usage statistics for the channel (last 30 days by default). Includes request counts, token usage, costs, and model breakdown. Only included when explicitly requested with include_usage=true parameter."
          }
        },
        "type": "object",
        "required": [
          "id",
          "title",
          "channel_id",
          "access_type",
          "is_active",
          "created_at",
          "updated_at"
        ],
        "title": "ChannelResponse",
        "description": "Response model for channel with usage statistics.\n\nIncludes API key prefix and usage data (one key per channel).\n\nField Distinction:\n- title: Human-friendly name for display purposes\n- channel_id: System identifier for routing/operations\n- access_type: 'public' or 'private'\n- Platform config: Shows overrides if set, NULL means using defaults\n- usage: Recent usage statistics (last 30 days by default)",
        "examples": [
          {
            "access_type": "private",
            "allow_model_switch": true,
            "api_key_last_used": "2025-01-15T14:30:00",
            "api_key_prefix": "ark_1234",
            "available_models": [
              "openai/gpt-5-chat",
              "google/gemini-2.0-flash-001"
            ],
            "channel_id": "Internal-BI",
            "created_at": "2025-01-01T10:00:00",
            "daily_quota": 5000,
            "default_model": "openai/gpt-5-chat",
            "id": 1,
            "is_active": true,
            "max_history": 25,
            "monthly_quota": 100000,
            "rate_limit": 80,
            "title": "Internal BI Team",
            "updated_at": "2025-01-15T14:30:00",
            "usage": {
              "cost": {
                "currency": "USD",
                "total": 15.5
              },
              "period": {
                "days": 30,
                "end": "2025-01-31T23:59:59",
                "start": "2025-01-01T00:00:00"
              },
              "requests": {
                "failed": 150,
                "successful": 14850,
                "total": 15000
              },
              "tokens": {
                "average_per_request": 100,
                "total": 1500000
              }
            }
          }
        ]
      },
      "ChannelUpdate": {
        "properties": {
          "title": {
            "anyOf": [
              {
                "type": "string",
                "maxLength": 200,
                "minLength": 1
              },
              {
                "type": "null"
              }
            ],
            "title": "Title",
            "description": "Update the human-friendly display name (supports Persian/Farsi). Leave null to keep existing value.",
            "examples": [
              "Internal BI Team",
              "Updated Marketing Platform"
            ]
          },
          "channel_id": {
            "anyOf": [
              {
                "type": "string",
                "maxLength": 100,
                "minLength": 1,
                "pattern": "^[a-zA-Z0-9_-]+$"
              },
              {
                "type": "null"
              }
            ],
            "title": "Channel Id",
            "description": "Update the system identifier for routing (ASCII only, no spaces). WARNING: Changing this will break existing sessions and API integrations. Leave null to keep existing value.",
            "examples": [
              "Internal-BI-Updated",
              "New-Channel-ID"
            ]
          },
          "access_type": {
            "anyOf": [
              {
                "type": "string",
                "pattern": "^(public|private)$"
              },
              {
                "type": "null"
              }
            ],
            "title": "Access Type",
            "description": "Update the platform access type ('public' or 'private'). Changing this affects default configurations but won't override explicitly set values. Leave null to keep existing value.",
            "examples": [
              "private",
              "public"
            ]
          },
          "monthly_quota": {
            "anyOf": [
              {
                "type": "integer",
                "minimum": 0.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Monthly Quota",
            "description": "Update monthly request quota. Set to 0 or very high value for unlimited. Leave null to keep existing value.",
            "examples": [
              150000,
              200000,
              0
            ]
          },
          "daily_quota": {
            "anyOf": [
              {
                "type": "integer",
                "minimum": 0.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Daily Quota",
            "description": "Update daily request quota. Set to 0 or very high value for unlimited. Leave null to keep existing value.",
            "examples": [
              7000,
              10000,
              0
            ]
          },
          "is_active": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Is Active",
            "description": "Enable or disable the channel. Inactive channels (is_active=false) cannot process any requests and return 403 errors. Used for temporarily suspending access without deleting the channel. Leave null to keep existing value.",
            "examples": [
              true,
              false
            ]
          },
          "rate_limit": {
            "anyOf": [
              {
                "type": "integer",
                "maximum": 1000.0,
                "minimum": 1.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Rate Limit",
            "description": "Update rate limit (requests/min per user). Set to null to reset to access_type default. Leave unchanged if not provided.",
            "examples": [
              60,
              80,
              100
            ]
          },
          "max_history": {
            "anyOf": [
              {
                "type": "integer",
                "maximum": 100.0,
                "minimum": 1.0
              },
              {
                "type": "null"
              }
            ],
            "title": "Max History",
            "description": "Update max conversation history length. Set to null to reset to access_type default. Leave unchanged if not provided.",
            "examples": [
              30,
              25,
              40
            ]
          },
          "default_model": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Default Model",
            "description": "Update default AI model. Set to null to reset to access_type default. Must be in available_models list.",
            "examples": [
              "openai/gpt-5-chat",
              "google/gemini-2.5-flash-001"
            ]
          },
          "available_models": {
            "anyOf": [
              {
                "items": {
                  "type": "string"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Available Models",
            "description": "Update available models list. Set to null to reset to access_type default. Must include default_model.",
            "examples": [
              [
                "openai/gpt-5-chat",
                "anthropic/claude-4.1"
              ],
              [
                "google/gemini-2.5-flash-001"
              ]
            ]
          },
          "allow_model_switch": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Allow Model Switch",
            "description": "Update model switching permission. Set to null to reset to access_type default.",
            "examples": [
              true,
              false
            ]
          }
        },
        "type": "object",
        "title": "ChannelUpdate",
        "description": "Request model for updating a channel.\n\nField Distinction:\n- title: Human-friendly name for admin UI and reports\n- channel_id: System identifier for routing and session isolation\n- access_type: 'public' or 'private'\n- Platform config overrides: Set to NULL to reset to defaults",
        "examples": [
          {
            "channel_id": "Internal-BI-Updated",
            "daily_quota": 7000,
            "is_active": true,
            "monthly_quota": 150000,
            "title": "Internal BI Team"
          },
          {
            "is_active": false
          },
          {
            "channel_id": "Marketing-Platform",
            "max_history": 25,
            "rate_limit": 80,
            "title": "Marketing Platform"
          },
          {
            "allow_model_switch": true,
            "available_models": [
              "openai/gpt-5-chat",
              "anthropic/claude-4.1"
            ],
            "default_model": "openai/gpt-5-chat"
          }
        ]
      },
      "ChannelsListResponse": {
        "properties": {
          "channels": {
            "items": {
              "$ref": "#/components/schemas/ChannelResponse"
            },
            "type": "array",
            "title": "Channels"
          },
          "total_report": {
            "anyOf": [
              {
                "additionalProperties": true,
                "type": "object"
              },
              {
                "type": "null"
              }
            ],
            "title": "Total Report",
            "description": "Total aggregated report across all channels (included when totally=true)"
          }
        },
        "type": "object",
        "required": [
          "channels"
        ],
        "title": "ChannelsListResponse",
        "description": "Response model for channels listing with optional total report",
        "examples": [
          {
            "channels": [
              {
                "api_key_prefix": "ark_1234",
                "channel_id": "Internal-BI",
                "daily_quota": 5000,
                "id": 1,
                "is_active": true,
                "monthly_quota": 100000,
                "title": "Internal BI Team",
                "usage": {
                  "requests": {
                    "successful": 14850,
                    "total": 15000
                  }
                }
              }
            ],
            "total_report": {
              "active_channels": 4,
              "total_channels": 5,
              "total_cost": 75.5,
              "total_failed": 750,
              "total_requests": 75000,
              "total_successful": 74250
            }
          }
        ]
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "IncomingMessage": {
        "properties": {
          "user_id": {
            "type": "string",
            "maxLength": 255,
            "minLength": 1,
            "title": "User Id",
            "description": "Unique identifier for the user within your channel. Used for session management and conversation isolation. Can be any format: numeric ID, UUID, email, username, or custom identifier. Same user_id always returns to the same conversation on this channel.",
            "examples": [
              "user_12345",
              "telegram_987654321",
              "customer@example.com",
              "550e8400-e29b-41d4-a716-446655440000"
            ]
          },
          "text": {
            "type": "string",
            "maxLength": 10000,
            "minLength": 1,
            "title": "Text",
            "description": "Message text content to process. Can be a regular chat message or a command (starting with '/'). Commands: /clear (reset history), /model (switch AI model), /help (show available commands), /status (session info). Regular messages are sent to the AI model for processing.",
            "examples": [
              "\u0633\u0644\u0627\u0645! \u0686\u0637\u0648\u0631 \u0645\u06cc\u200c\u062a\u0648\u0646\u0645 \u06a9\u0645\u06a9\u062a\u0648\u0646 \u06a9\u0646\u0645\u061f",
              "What is the capital of France?",
              "Explain quantum computing in simple terms",
              "/clear",
              "/model gemini",
              "/help"
            ]
          }
        },
        "type": "object",
        "required": [
          "user_id",
          "text"
        ],
        "title": "IncomingMessage",
        "description": "Incoming chat message request for processing by the AI service.\n\n**Architecture & Session Management:**\n- Each user maintains ONE continuous conversation per platform/channel\n- No conversation_id required - sessions are automatically managed based on `user_id`\n- Messages are persisted in the database for audit and conversation history\n- `/clear` command excludes previous messages from AI context while preserving database records\n- Platform routing is auto-detected from the API key's channel configuration\n\n**Usage Pattern:**\n1. External channel sends message with user_id and text\n2. Service looks up or creates session for this user on this channel\n3. Message is added to conversation history\n4. AI processes message with full conversation context\n5. Response is returned and logged\n\n**Commands:**\nMessages starting with `/` are treated as commands (e.g., `/clear`, `/model`, `/help`).\nRegular text messages are processed by the AI model.\n\n**User ID Guidelines:**\n- Must be unique within your channel/platform\n- Can be any string format: numeric IDs, UUIDs, emails, usernames\n- Same user_id always returns to the same conversation\n- Different channels maintain separate conversations even with same user_id",
        "examples": [
          {
            "text": "\u0633\u0644\u0627\u0645\u060c \u0686\u0637\u0648\u0631 \u0645\u06cc\u200c\u062a\u0648\u0646\u0645 \u0633\u0641\u0627\u0631\u0634\u0645 \u0631\u0648 \u067e\u06cc\u06af\u06cc\u0631\u06cc \u06a9\u0646\u0645\u061f",
            "user_id": "user_12345"
          },
          {
            "text": "What are the main differences between GPT-4 and Claude?",
            "user_id": "telegram_987654321"
          },
          {
            "text": "Help me understand my invoice",
            "user_id": "customer@example.com"
          },
          {
            "text": "/clear",
            "user_id": "550e8400-e29b-41d4-a716-446655440000"
          },
          {
            "text": "/model gpt5",
            "user_id": "internal_user_42"
          }
        ]
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          }
        },
        "type": "object",
        "required": [
          "loc",
          "msg",
          "type"
        ],
        "title": "ValidationError"
      }
    },
    "securitySchemes": {
      "HTTPBearer": {
        "type": "http",
        "scheme": "bearer"
      }
    }
  },
  "tags": [
    {
      "name": "Chat & Commands",
      "description": "\n**Chat message processing and command management for external channels.**\n\nThese endpoints allow external channels (clients) to send chat messages and retrieve available commands.\nAuthentication is required via API keys for channel access or Telegram service key for bot access.\n\n**Key Features:**\n- Process chat messages with AI models\n- Retrieve available commands for the authenticated channel\n- Support for both Telegram and custom channel integrations\n- Automatic session management and conversation history\n        "
    },
    {
      "name": "Channel Management & Administration",
      "description": "\n**Administrative endpoints for managing channels, API keys, and usage analytics.**\n\nThese endpoints are **exclusively accessible to super administrators** via super admin API keys\ndefined in the environment configuration (not stored in the database).\n\n**Capabilities:**\n- Create, update, and manage channels\n- View comprehensive usage statistics across all channels\n- Monitor platform configurations (Telegram + Internal channels)\n- Track API key usage and performance metrics\n\n**Security Note:** External channels have no access to these endpoints. Only super admins can view\nplatform-wide information and manage multi-tenant configurations.\n        "
    },
    {
      "name": "Health & Monitoring",
      "description": "\n**Service health check and status monitoring endpoints.**\n\nThese endpoints provide real-time health status for monitoring systems and load balancers.\nNo authentication required - designed for infrastructure monitoring.\n\n**Use Cases:**\n- Kubernetes liveness/readiness probes\n- Load balancer health checks\n- Service discovery and monitoring\n- Uptime tracking\n        "
    }
  ]
}